<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vendor - SapaSpots</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="favicon.svg" type="image/svg+xml">
  <style>
    /* Vendor page styles */
    .vendor-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1.5rem;
    }
    
    .vendor-header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 2rem;
      margin-bottom: 2rem;
    }
    
    .vendor-info {
      flex: 1;
      min-width: 300px;
    }
    
    .vendor-title {
      font-size: 2rem;
      font-weight: 700;
      color: #212529;
      margin-bottom: 0.5rem;
    }
    
    .vendor-subtitle {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      color: #6c757d;
      font-size: 1rem;
      margin-bottom: 1rem;
    }
    
    .vendor-rating {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    
    .vendor-rating-stars {
      color: #ffc107;
      font-size: 1.1rem;
    }
    
    .vendor-reviews {
      color: #6c757d;
      font-size: 0.9rem;
    }
    
    .vendor-badges {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    
    .vendor-badge {
      background-color: #f1f3f5;
      color: #495057;
      font-size: 0.8rem;
      padding: 0.3rem 0.75rem;
      border-radius: 4px;
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }
    
    .vendor-badge svg {
      width: 14px;
      height: 14px;
    }
    
    .wifi-badge {
      background-color: #e6f0ff;
      color: #0066cc;
    }
    
    .delivery-badge {
      background-color: #fff1e5;
      color: #fd7e14;
    }
    
    .card-badge {
      background-color: #e9ecef;
      color: #343a40;
    }
    
    .vendor-status {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    
    .status-indicator {
      font-size: 0.9rem;
      font-weight: 600;
      padding: 0.3rem 0.75rem;
      border-radius: 4px;
      text-transform: uppercase;
    }
    
    .status-open {
      background-color: #d4edda;
      color: #155724;
    }
    
    .status-closed {
      background-color: #f8d7da;
      color: #721c24;
    }
    
    .vendor-image {
      width: 100%;
      max-width: 300px;
      height: 200px;
      border-radius: 12px;
      object-fit: cover;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    
    .vendor-details {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      margin-bottom: 1.5rem;
    }
    
    .vendor-detail {
      display: flex;
      align-items: flex-start;
      gap: 0.5rem;
      color: #495057;
      font-size: 0.95rem;
    }
    
    .vendor-detail svg {
      width: 18px;
      height: 18px;
      color: #6c757d;
      margin-top: 0.2rem;
      flex-shrink: 0;
    }
    
    .vendor-description {
      color: #495057;
      font-size: 1rem;
      line-height: 1.6;
      margin-bottom: 2rem;
    }
    
    /* Menu section styles */
    .menu-section {
      margin-bottom: 3rem;
    }
    
    .menu-header {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      gap: 1rem;
    }
    
    .menu-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: #212529;
    }
    
    .menu-categories {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
    }
    
    .menu-category {
      padding: 0.5rem 1rem;
      background-color: #fff;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      font-size: 0.9rem;
      color: #495057;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .menu-category:hover {
      background-color: #f8f9fa;
    }
    
    .menu-category.active {
      background-color: #e6f0ff;
      border-color: #0066cc;
      color: #0066cc;
      font-weight: 500;
    }
    
    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1.5rem;
    }
    
    .menu-item {
      background-color: #fff;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      transition: all 0.3s ease;
    }
    
    .menu-item:hover {
      transform: translateY(-4px);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    }
    
    .menu-item.unavailable {
      opacity: 0.7;
    }
    
    .menu-item-image {
      height: 160px;
      width: 100%;
      object-fit: cover;
    }
    
    .menu-item-content {
      padding: 1.25rem;
    }
    
    .menu-item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.75rem;
    }
    
    .menu-item-title {
      font-weight: 600;
      font-size: 1.1rem;
      color: #212529;
      margin: 0;
    }
    
    .menu-item-price {
      font-weight: 700;
      color: #0066cc;
      font-size: 1.1rem;
    }
    
    .menu-item-description {
      color: #6c757d;
      font-size: 0.9rem;
      margin-bottom: 1.25rem;
      line-height: 1.5;
    }
    
    .menu-item-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .menu-item-status {
      font-size: 0.8rem;
      font-weight: 500;
    }
    
    .status-available {
      color: #28a745;
    }
    
    .status-unavailable {
      color: #dc3545;
    }
    
    .add-to-tray {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background-color: #0066cc;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .add-to-tray:hover {
      background-color: #0052a3;
    }
    
    .add-to-tray:disabled {
      background-color: #e9ecef;
      color: #adb5bd;
      cursor: not-allowed;
    }
    
    .add-to-tray svg {
      width: 16px;
      height: 16px;
    }
    
    /* Mini cart styles */
    .mini-cart {
      position: sticky;
      top: 7rem;
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      padding: 1.5rem;
      margin-bottom: 2rem;
      max-height: calc(100vh - 10rem);
      overflow-y: auto;
    }
    
    .mini-cart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.25rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid #f1f3f5;
    }
    
    .mini-cart-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: #212529;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .mini-cart-title svg {
      width: 18px;
      height: 18px;
    }
    
    .mini-cart-count {
      background-color: #0066cc;
      color: white;
      font-size: 0.8rem;
      font-weight: 600;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
    }
    
    .mini-cart-items {
      margin-bottom: 1.5rem;
    }
    
    .mini-cart-empty {
      text-align: center;
      color: #6c757d;
      padding: 2rem 0;
    }
    
    .mini-cart-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0.75rem 0;
      border-bottom: 1px solid #f1f3f5;
    }
    
    .mini-cart-item-info {
      flex: 1;
    }
    
    .mini-cart-item-title {
      font-weight: 500;
      font-size: 0.95rem;
      color: #212529;
      margin-bottom: 0.25rem;
    }
    
    .mini-cart-item-price {
      color: #6c757d;
      font-size: 0.85rem;
    }
    
    .mini-cart-item-quantity {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .quantity-btn {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      color: #212529;
      font-size: 1rem;
      line-height: 1;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .quantity-btn:hover {
      background-color: #e9ecef;
    }
    
    .quantity-value {
      font-size: 0.9rem;
      font-weight: 500;
      color: #212529;
      min-width: 1.5rem;
      text-align: center;
    }
    
    .remove-item {
      padding: 0.25rem;
      color: #dc3545;
      cursor: pointer;
      margin-left: 0.5rem;
    }
    
    .remove-item svg {
      width: 16px;
      height: 16px;
    }
    
    .mini-cart-summary {
      margin-top: 1rem;
    }
    
    .mini-cart-summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 0.5rem;
      font-size: 0.9rem;
      color: #6c757d;
    }
    
    .mini-cart-total {
      display: flex;
      justify-content: space-between;
      padding-top: 0.75rem;
      margin-top: 0.75rem;
      border-top: 1px solid #dee2e6;
      font-weight: 700;
      font-size: 1.1rem;
      color: #212529;
    }
    
    .checkout-btn {
      width: 100%;
      padding: 0.875rem;
      background-color: #0066cc;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 1.5rem;
    }
    
    .checkout-btn:hover {
      background-color: #0052a3;
    }
    
    .checkout-btn:disabled {
      background-color: #e9ecef;
      color: #adb5bd;
      cursor: not-allowed;
    }
    
    .checkout-btn svg {
      width: 18px;
      height: 18px;
    }
    
    /* Main layout */
    .vendor-layout {
      display: grid;
      grid-template-columns: 1fr 350px;
      gap: 2rem;
      margin-top: 2rem;
    }
    
    /* Back button */
    .back-button {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background-color: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      color: #495057;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: 1.5rem;
    }
    
    .back-button:hover {
      background-color: #e9ecef;
    }
    
    .back-button svg {
      width: 16px;
      height: 16px;
    }
    
    /* Responsive styles */
    @media (max-width: 992px) {
      .vendor-layout {
        grid-template-columns: 1fr;
      }
      
      .mini-cart {
        position: static;
        margin-bottom: 2rem;
      }
      
      .menu-grid {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      }
    }
    
    @media (max-width: 768px) {
      .vendor-container {
        padding: 1rem;
      }
      
      .vendor-header {
        gap: 1.5rem;
      }
      
      .vendor-title {
        font-size: 1.8rem;
      }
      
      .menu-grid {
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 1rem;
      }
      
      .menu-item-image {
        height: 140px;
      }
    }
    
    @media (max-width: 480px) {
      .menu-grid {
        grid-template-columns: 1fr;
      }
      
      .menu-categories {
        overflow-x: auto;
        padding-bottom: 0.5rem;
        width: 100%;
        flex-wrap: nowrap;
      }
      
      .menu-category {
        white-space: nowrap;
      }
      
      .vendor-image {
        max-width: 100%;
      }
    }
  </style>
</head>
<body>
  <!-- Header will be loaded here -->
  <div id="header-container"></div>
  
  <main>
    <div class="vendor-container">
      <button class="back-button" onclick="goBack()">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M19 12H5"></path>
          <path d="M12 19l-7-7 7-7"></path>
        </svg>
        Back to Vendors
      </button>
      
      <div class="vendor-header">
        <div class="vendor-info">
          <h1 class="vendor-title" id="vendor-name">Loading...</h1>
          <div class="vendor-subtitle" id="vendor-category"></div>
          <div class="vendor-rating">
            <span class="vendor-rating-stars" id="vendor-rating"></span>
            <span class="vendor-reviews" id="vendor-reviews"></span>
          </div>
          <div class="vendor-badges" id="vendor-badges"></div>
          <div class="vendor-status" id="vendor-status"></div>
        </div>
        <img src="" alt="" class="vendor-image" id="vendor-image">
      </div>
      
      <div class="vendor-details">
        <div class="vendor-detail">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
            <circle cx="12" cy="10" r="3"></circle>
          </svg>
          <span id="vendor-location"></span>
        </div>
        <div class="vendor-detail">
          <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <polyline points="12 6 12 12 16 14"></polyline>
          </svg>
          <span id="vendor-hours"></span>
        </div>
      </div>
      
      <div class="vendor-description" id="vendor-description"></div>
      
      <div class="vendor-layout">
        <div class="menu-section">
          <div class="menu-header">
            <h2 class="menu-title">Menu</h2>
            <div class="menu-categories" id="menu-categories">
              <button class="menu-category active" data-category="all">All Items</button>
              <!-- More categories will be added dynamically -->
            </div>
          </div>
          
          <div class="menu-grid" id="menu-grid">
            <!-- Menu items will be populated with JavaScript -->
          </div>
        </div>
        
        <div class="mini-cart" id="mini-cart">
          <div class="mini-cart-header">
            <h3 class="mini-cart-title">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="9" cy="21" r="1"></circle>
                <circle cx="20" cy="21" r="1"></circle>
                <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
              </svg>
              Your Order
            </h3>
            <span class="mini-cart-count" id="cart-item-count">0</span>
          </div>
          
          <div class="mini-cart-items" id="mini-cart-items">
            <div class="mini-cart-empty">Your tray is empty</div>
          </div>
          
          <div class="mini-cart-summary">
            <div class="mini-cart-summary-row">
              <span>Subtotal</span>
              <span id="cart-subtotal">UGX 0</span>
            </div>
            <div class="mini-cart-summary-row">
              <span>Delivery Fee</span>
              <span>UGX 1,000</span>
            </div>
            <div class="mini-cart-total">
              <span>Total</span>
              <span id="cart-total">UGX 1,000</span>
            </div>
          </div>
          
          <button class="checkout-btn" id="checkout-btn" disabled>
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="12" y1="1" x2="12" y2="23"></line>
              <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
            Proceed to Checkout
          </button>
        </div>
      </div>
    </div>
  </main>
  
  <!-- Footer will be loaded here -->
  <div id="footer-container"></div>
  
  <script src="localstorage-utils.js"></script>
  <script src="script.js"></script>
  <script src="realtime-sync.js"></script>
  <script>
    // Get vendor ID from query string
    function getVendorId() {
      const urlParams = new URLSearchParams(window.location.search);
      return urlParams.get('id');
    }
    
    // Load vendor data from localStorage
    function loadVendorData() {
      const vendorId = getVendorId();
      if (!vendorId) {
        window.location.href = 'vendors.html';
        return null;
      }
      
      // Get vendors from localStorage
      const vendors = JSON.parse(localStorage.getItem('vendors')) || [];
      
      // Find the vendor with matching ID
      const vendor = vendors.find(v => v.id === vendorId);
      
      if (!vendor) {
        window.location.href = 'vendors.html';
        return null;
      }
      
      return vendor;
    }
    
    // Render star rating
    function renderStars(rating) {
      let stars = '';
      for (let i = 1; i <= 5; i++) {
        if (i <= rating) {
          stars += '★';
        } else {
          stars += '☆';
        }
      }
      return stars;
    }
    
    // Format price in UGX
    function formatPrice(price) {
      return `UGX ${price.toLocaleString()}`;
    }
    
    // Populate vendor information
    function populateVendorInfo(vendor) {
      document.getElementById('vendor-name').textContent = vendor.name;
      document.getElementById('vendor-category').innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path>
          <line x1="7" y1="7" x2="7.01" y2="7"></line>
        </svg>
        ${vendor.category}
      `;
      document.getElementById('vendor-rating').textContent = renderStars(vendor.rating);
      document.getElementById('vendor-reviews').textContent = `(${vendor.reviews} reviews)`;
      document.getElementById('vendor-location').textContent = vendor.location;
      document.getElementById('vendor-hours').textContent = vendor.hours;
      document.getElementById('vendor-description').textContent = vendor.description;
      document.getElementById('vendor-image').src = vendor.image;
      document.getElementById('vendor-image').alt = vendor.name;
      
      // Set vendor status (open/closed)
      const statusHtml = `
        <span class="status-indicator ${vendor.open ? 'status-open' : 'status-closed'}">
          ${vendor.open ? 'Open' : 'Closed'}
        </span>
        ${vendor.open ? 'Accepting orders now' : 'Currently not accepting orders'}
      `;
      document.getElementById('vendor-status').innerHTML = statusHtml;
      
      // Set page title
      document.title = `${vendor.name} - SapaSpots`;
      
      // Render badges
      const badgesContainer = document.getElementById('vendor-badges');
      badgesContainer.innerHTML = '';
      
      vendor.badges.forEach(badge => {
        let badgeClass = '';
        let badgeIcon = '';
        
        if (badge === 'Free Wi-Fi') {
          badgeClass = 'wifi-badge';
          badgeIcon = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 12.55a11 11 0 0 1 14.08 0"></path><path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path><line x1="12" y1="20" x2="12.01" y2="20"></line></svg>';
        } else if (badge === 'Delivery') {
          badgeClass = 'delivery-badge';
          badgeIcon = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 17h6a2 2 0 0 0 2-2v-2h2a1 1 0 0 0 .89-1.46L18 7a1 1 0 0 0-.89-.54h-5V5a1 1 0 0 0-1-1H3a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h2"></path><circle cx="13" cy="17" r="2"></circle><circle cx="5" cy="17" r="2"></circle></svg>';
        } else if (badge === 'Card Payment') {
          badgeClass = 'card-badge';
          badgeIcon = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="5" width="20" height="14" rx="2" ry="2"></rect><line x1="2" y1="10" x2="22" y2="10"></line></svg>';
        } else if (badge === 'Parking') {
          badgeIcon = '<svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><path d="M9 9h4a2 2 0 0 1 0 4h-4V9z"></path><line x1="9" y1="13" x2="9" y2="17"></line></svg>';
        }
        
        const badgeElement = document.createElement('div');
        badgeElement.className = `vendor-badge ${badgeClass}`;
        badgeElement.innerHTML = `${badgeIcon}${badge}`;
        badgesContainer.appendChild(badgeElement);
      });
    }
    
    // Sample menu data - in a real app, this would be loaded dynamically
    function generateMenuItems(vendorId) {
      // Map of sample menu items for each vendor
      const menuMap = {
        "v1": [ // THE CAMPUS BARBEQUE CENTRE
          { id: "bbq1", name: "Beef Roast", price: 15000, available: true, description: "Succulent beef roasted to perfection", category: "BBQ", image: "steak.jpg" },
          { id: "bbq2", name: "Pork Ribs", price: 18000, available: true, description: "Tender pork ribs with our special sauce", category: "BBQ", image: "pork-roast.jpg" },
          { id: "bbq3", name: "Chicken Platter", price: 16000, available: true, description: "Grilled chicken with side vegetables", category: "BBQ", image: "chicken.jpeg" },
          { id: "bbq4", name: "Beef Burger", price: 12000, available: true, description: "Classic beef burger with fresh toppings", category: "Fast Food", image: "burger.jpg" },
          { id: "bbq5", name: "BBQ Combo", price: 25000, available: false, description: "Mix of pork, beef and chicken with sides", category: "BBQ", image: "berbeque.jpg" },
          { id: "bbq6", name: "Chips", price: 5000, available: true, description: "Crispy french fries", category: "Sides", image: "fries.jpg" }
        ],
        "v2": [ // Best Foods Restaurant
          { id: "bf1", name: "Matooke & Groundnut", price: 10000, available: true, description: "Traditional steamed banana with groundnut sauce", category: "Local", image: "matooke.webp" },
          { id: "bf2", name: "Rice & Chicken", price: 12000, available: true, description: "Perfectly cooked rice with chicken stew", category: "Local", image: "chicken.jpeg" },
          { id: "bf3", name: "Posho & Beans", price: 8000, available: true, description: "Posho served with delicious beans", category: "Local", image: "beans.jpg" },
          { id: "bf4", name: "Fish & Chips", price: 15000, available: true, description: "Fried fish served with chips", category: "Local", image: "fish.webp" },
          { id: "bf5", name: "Vegetable Platter", price: 9000, available: true, description: "Mix of fresh local vegetables", category: "Vegetables", image: "vegetable.jpg" }
        ],
        "v3": [ // Crave Cave Takeaway Restaurant
          { id: "cc1", name: "Pepperoni Pizza", price: 18000, available: true, description: "Classic pepperoni pizza with mozzarella", category: "Pizza", image: "pizza.jpg" },
          { id: "cc2", name: "Veggie Pizza", price: 16000, available: true, description: "Fresh vegetables on a crispy crust", category: "Pizza", image: "pizza2.jpg" },
          { id: "cc3", name: "Chicken Wings", price: 14000, available: false, description: "Spicy chicken wings, 8pcs", category: "Fast Food", image: "chicken.jpeg" },
          { id: "cc4", name: "French Fries", price: 7000, available: true, description: "Crispy golden fries", category: "Sides", image: "fries1.jpg" },
          { id: "cc5", name: "Soda", price: 3000, available: true, description: "Assorted sodas", category: "Drinks", image: "juice.webp" }
        ],
        "v4": [ // UMAR CHICKEN PRESIDENT
          { id: "uc1", name: "Fried Chicken", price: 12000, available: true, description: "Crispy fried chicken, 2pcs", category: "Fast Food", image: "chicken.jpeg" },
          { id: "uc2", name: "Chicken & Chips", price: 15000, available: true, description: "Fried chicken with a side of chips", category: "Fast Food", image: "fries.jpg" },
          { id: "uc3", name: "Beef Steak", price: 18000, available: true, description: "Grilled beef steak with vegetables", category: "Grill", image: "steak.jpg" },
          { id: "uc4", name: "Fish Fillet", price: 16000, available: false, description: "Breaded fish fillet with tartar sauce", category: "Seafood", image: "fish.webp" },
          { id: "uc5", name: "Chicken Burger", price: 10000, available: true, description: "Chicken burger with special sauce", category: "Fast Food", image: "burger.jpg" }
        ],
        "v5": [ // COCIS BLOCK B
          { id: "cb1", name: "Tilapia Fish", price: 20000, available: true, description: "Fresh tilapia fish, grilled or fried", category: "Seafood", image: "fish.webp" },
          { id: "cb2", name: "Rice & Beef", price: 12000, available: true, description: "Rice served with beef stew", category: "Local", image: "rice.webp" },
          { id: "cb3", name: "Coffee", price: 5000, available: true, description: "Freshly brewed coffee", category: "Drinks", image: "coffee.jpeg" },
          { id: "cb4", name: "Chapati & Beans", price: 7000, available: true, description: "Chapati served with beans", category: "Local", image: "beans.jpg" },
          { id: "cb5", name: "Fruit Salad", price: 6000, available: true, description: "Mix of fresh seasonal fruits", category: "Dessert", image: "salad1.jpg" }
        ],
        "v6": [ // Guild Canteen
          { id: "gc1", name: "Rolex", price: 5000, available: true, description: "Classic Ugandan rolex with eggs and vegetables", category: "Fast Food", image: "rolex.jpg" },
          { id: "gc2", name: "Chips & Chicken", price: 14000, available: true, description: "Chips with grilled or fried chicken", category: "Fast Food", image: "fries.jpg" },
          { id: "gc3", name: "Beef Sandwich", price: 8000, available: true, description: "Beef sandwich with fresh vegetables", category: "Fast Food", image: "burger.jpg" },
          { id: "gc4", name: "Milk Tea", price: 4000, available: true, description: "Hot milk tea", category: "Drinks", image: "milk-tea.webp" },
          { id: "gc5", name: "Black Tea", price: 3000, available: true, description: "Hot black tea", category: "Drinks", image: "black-tea.webp" }
        ],
        "v7": [ // Africa Hall Cafeteria
          { id: "ah1", name: "Posho & Greens", price: 7000, available: true, description: "Posho served with fresh greens", category: "Local", image: "greens1.jpg" },
          { id: "ah2", name: "Rice & Groundnut", price: 10000, available: true, description: "Rice with groundnut sauce", category: "Local", image: "rice.webp" },
          { id: "ah3", name: "Matooke & Fish", price: 15000, available: false, description: "Steamed matooke with fish", category: "Local", image: "matooke.webp" },
          { id: "ah4", name: "Chapati & Beans", price: 6000, available: true, description: "Freshly made chapati with beans", category: "Local", image: "beans.jpg" },
          { id: "ah5", name: "Vegetable Stew", price: 8000, available: true, description: "Mix vegetable stew", category: "Vegetables", image: "greens.jpg" }
        ],
        "v8": [ // Nsibirwa Hall Canteen
          { id: "nh1", name: "Beans & Rice", price: 8000, available: true, description: "Rice served with beans", category: "Local", image: "beans1.jpg" },
          { id: "nh2", name: "Spaghetti", price: 9000, available: true, description: "Spaghetti with tomato sauce", category: "Fast Food", image: "spaghetti.jpg" },
          { id: "nh3", name: "Breakfast Combo", price: 10000, available: true, description: "Tea, eggs, and toast", category: "Breakfast", image: "coffee.jpeg" },
          { id: "nh4", name: "Rolex Deluxe", price: 6000, available: false, description: "Rolex with extra eggs and vegetables", category: "Fast Food", image: "rolex-chapati.jpeg" },
          { id: "nh5", name: "Fresh Juice", price: 5000, available: true, description: "Fresh fruit juice, various flavors", category: "Drinks", image: "juice.webp" }
        ]
      };
      
      return menuMap[vendorId] || [];
    }
    
    // Render menu categories
    function renderMenuCategories(menuItems) {
      // Get unique categories
      const categories = [...new Set(menuItems.map(item => item.category))];
      
      const categoriesContainer = document.getElementById('menu-categories');
      
      // Keep the "All Items" button and add categories
      categories.forEach(category => {
        const categoryButton = document.createElement('button');
        categoryButton.className = 'menu-category';
        categoryButton.textContent = category;
        categoryButton.dataset.category = category;
        
        categoryButton.addEventListener('click', function() {
          // Remove active class from all buttons
          document.querySelectorAll('.menu-category').forEach(btn => {
            btn.classList.remove('active');
          });
          
          // Add active class to clicked button
          this.classList.add('active');
          
          // Filter menu items
          filterMenuItems(category);
        });
        
        categoriesContainer.appendChild(categoryButton);
      });
    }
    
    // Filter menu items by category
    function filterMenuItems(category) {
      const menuItems = document.querySelectorAll('.menu-item');
      
      menuItems.forEach(item => {
        if (category === 'all' || item.dataset.category === category) {
          item.style.display = '';
        } else {
          item.style.display = 'none';
        }
      });
    }
    
    // Render menu items
    function renderMenuItems(menuItems) {
      const menuGrid = document.getElementById('menu-grid');
      menuGrid.innerHTML = '';
      
      menuItems.forEach(item => {
        const menuItem = document.createElement('div');
        menuItem.className = `menu-item ${!item.available ? 'unavailable' : ''}`;
        menuItem.dataset.category = item.category;
        menuItem.dataset.id = item.id;
        
        menuItem.innerHTML = `
          <img src="${item.image}" alt="${item.name}" class="menu-item-image">
          <div class="menu-item-content">
            <div class="menu-item-header">
              <h3 class="menu-item-title">${item.name}</h3>
              <span class="menu-item-price">${formatPrice(item.price)}</span>
            </div>
            <p class="menu-item-description">${item.description}</p>
            <div class="menu-item-footer">
              <span class="menu-item-status ${item.available ? 'status-available' : 'status-unavailable'}">
                ${item.available ? 'Available' : 'Unavailable'}
              </span>
              <button class="add-to-tray" data-id="${item.id}" data-name="${item.name}" data-price="${item.price}" ${!item.available ? 'disabled' : ''}>
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Add to Tray
              </button>
            </div>
          </div>
        `;
        
        menuGrid.appendChild(menuItem);
      });
      
      // Add event listeners to "Add to Tray" buttons
      document.querySelectorAll('.add-to-tray').forEach(button => {
        button.addEventListener('click', function() {
          const itemId = this.dataset.id;
          const itemName = this.dataset.name;
          const itemPrice = parseFloat(this.dataset.price);
          
          addItemToTray(itemId, itemName, itemPrice);
        });
      });
    }
    
    // Get tray items from localStorage
    function getTrayItems() {
      const tray = localStorage.getItem('tray');
      return tray ? JSON.parse(tray) : [];
    }
    
    // Save tray items to localStorage
    function saveTrayItems(items) {
      localStorage.setItem('tray', JSON.stringify(items));
    }
    
    // Add item to tray
    function addItemToTray(itemId, itemName, itemPrice) {
      const vendorId = getVendorId();
      const trayItems = getTrayItems();
      
      // Check if the item already exists in the tray
      const existingItemIndex = trayItems.findIndex(item => item.itemId === itemId && item.vendorId === vendorId);
      
      if (existingItemIndex >= 0) {
        // Increment quantity if item exists
        trayItems[existingItemIndex].qty += 1;
      } else {
        // Add new item to tray
        trayItems.push({
          vendorId: vendorId,
          itemId: itemId,
          name: itemName,
          price: itemPrice,
          qty: 1
        });
      }
      
      // Save updated tray
      saveTrayItems(trayItems);
      
      // Update mini-cart UI
      updateMiniCart();
    }
    
    // Update quantity of an item in the tray
    function updateItemQuantity(itemId, change) {
      const vendorId = getVendorId();
      const trayItems = getTrayItems();
      
      const itemIndex = trayItems.findIndex(item => item.itemId === itemId && item.vendorId === vendorId);
      
      if (itemIndex >= 0) {
        // Update quantity
        trayItems[itemIndex].qty += change;
        
        // Remove item if quantity is 0 or less
        if (trayItems[itemIndex].qty <= 0) {
          trayItems.splice(itemIndex, 1);
        }
        
        // Save updated tray
        saveTrayItems(trayItems);
        
        // Update mini-cart UI
        updateMiniCart();
      }
    }
    
    // Remove item from tray
    function removeItemFromTray(itemId) {
      const vendorId = getVendorId();
      const trayItems = getTrayItems();
      
      // Filter out the item to remove
      const updatedTrayItems = trayItems.filter(item => !(item.itemId === itemId && item.vendorId === vendorId));
      
      // Save updated tray
      saveTrayItems(updatedTrayItems);
      
      // Update mini-cart UI
      updateMiniCart();
    }
    
    // Calculate total price of items in tray
    function calculateTotal(items) {
      return items.reduce((total, item) => total + (item.price * item.qty), 0);
    }
    
    // Update mini-cart UI
    function updateMiniCart() {
      const vendorId = getVendorId();
      const trayItems = getTrayItems().filter(item => item.vendorId === vendorId);
      
      const miniCartItems = document.getElementById('mini-cart-items');
      const cartItemCount = document.getElementById('cart-item-count');
      const cartSubtotal = document.getElementById('cart-subtotal');
      const cartTotal = document.getElementById('cart-total');
      const checkoutBtn = document.getElementById('checkout-btn');
      
      // Update item count
      const totalItems = trayItems.reduce((count, item) => count + item.qty, 0);
      cartItemCount.textContent = totalItems;
      
      // Enable/disable checkout button
      checkoutBtn.disabled = totalItems === 0;
      
      // Display empty cart message if no items
      if (trayItems.length === 0) {
        miniCartItems.innerHTML = '<div class="mini-cart-empty">Your tray is empty</div>';
        cartSubtotal.textContent = 'UGX 0';
        cartTotal.textContent = 'UGX 1,000';
        return;
      }
      
      // Render cart items
      miniCartItems.innerHTML = '';
      
      trayItems.forEach(item => {
        const itemElement = document.createElement('div');
        itemElement.className = 'mini-cart-item';
        
        itemElement.innerHTML = `
          <div class="mini-cart-item-info">
            <div class="mini-cart-item-title">${item.name}</div>
            <div class="mini-cart-item-price">${formatPrice(item.price)} × ${item.qty}</div>
          </div>
          <div class="mini-cart-item-quantity">
            <button class="quantity-btn decrement-btn" data-id="${item.itemId}">-</button>
            <span class="quantity-value">${item.qty}</span>
            <button class="quantity-btn increment-btn" data-id="${item.itemId}">+</button>
            <span class="remove-item" data-id="${item.itemId}">
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M3 6h18"></path>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
              </svg>
            </span>
          </div>
        `;
        
        miniCartItems.appendChild(itemElement);
      });
      
      // Add event listeners to quantity buttons
      document.querySelectorAll('.increment-btn').forEach(button => {
        button.addEventListener('click', function() {
          updateItemQuantity(this.dataset.id, 1);
        });
      });
      
      document.querySelectorAll('.decrement-btn').forEach(button => {
        button.addEventListener('click', function() {
          updateItemQuantity(this.dataset.id, -1);
        });
      });
      
      document.querySelectorAll('.remove-item').forEach(button => {
        button.addEventListener('click', function() {
          removeItemFromTray(this.dataset.id);
        });
      });
      
      // Update subtotal and total
      const subtotal = calculateTotal(trayItems);
      const deliveryFee = 1000; // Fixed delivery fee
      const total = subtotal + deliveryFee;
      
      cartSubtotal.textContent = formatPrice(subtotal);
      cartTotal.textContent = formatPrice(total);
    }
    
    // Navigate back to vendors page
    function goBack() {
      window.history.back();
    }
    
    // Set up checkout button
    function setupCheckoutButton() {
      const checkoutBtn = document.getElementById('checkout-btn');
      
      checkoutBtn.addEventListener('click', function() {
        const vendorId = getVendorId();
        window.location.href = `order-details.html?vendor=${vendorId}`;
      });
    }
    
    // Initialize the page
    document.addEventListener('DOMContentLoaded', () => {
      // Load vendor data
      const vendor = loadVendorData();
      
      if (vendor) {
        // Populate vendor information
        populateVendorInfo(vendor);
        
        // Generate and render menu items
        const menuItems = generateMenuItems(vendor.id);
        renderMenuItems(menuItems);
        
        // Render menu categories
        renderMenuCategories(menuItems);
        
        // Update mini cart
        updateMiniCart();
        
        // Set up checkout button
        setupCheckoutButton();
      }
      
      // Set up all items category button
      document.querySelector('[data-category="all"]').addEventListener('click', function() {
        document.querySelectorAll('.menu-category').forEach(btn => {
          btn.classList.remove('active');
        });
        this.classList.add('active');
        filterMenuItems('all');
      });
    });
  </script>
</body>
</html> 